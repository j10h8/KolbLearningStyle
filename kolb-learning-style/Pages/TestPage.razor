@page "/TestPage"
@inject IResultService ResultService
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager
@layout CustomLayout

<PageTitle>Test Page</PageTitle>

<div class="font-example">


	<div class="center-container">
	</div>
	<div class="center-container">

		<p>

			<h1>
				Kolbs lärstilar: testa din inlärningsstil
			</h1>
			@*<br />*@

			@*<br />*@
			@*<h2> Instruktion </h2>*@
			<br />
			@*<b>Nedan ser du nio rader med fyra ord i varje rad</b>*@



			<ul>
				@* <br /> *@
				@*<p>
				Jämför varje vågrät uppsättning med fyra ord genom att ge 4 till det ord som du tycker bäst
				beskriver din inlärningsstil, ge 3 till det ord som näst bäst karakteriserar din inlärningsstil, 2
				till det näst minst karakteristiska ordet och 1 till det ord som minst karakteriserar hur du lär
				dig.
				</p>*@

				@*<SurveyPrompt Title="Jämför varje vågrät uppsättning med fyra ord genom att ge 4 till det ord som du tycker bäst
			beskriver din inlärningsstil, ge 3 till det ord som näst bäst karakteriserar din inlärningsstil, 2
			till det näst minst karakteristiska ordet och 1 till det ord som minst karakteriserar hur du lär
			dig." />*@
				@*<br />
				<hr />
				<br />*@
				@*<p>
				<b>
				Uppskatta varje rad för sig och tänk på situationer då du arbetar eller studerar och tar in ny
				information eller arbetsuppgifter, hur gör du?
				</b>
				</p>*@

				@*<SurveyPrompt Title="Uppskatta varje rad för sig och tänk på situationer då du arbetar eller studerar och tar in ny
			information eller arbetsuppgifter, hur gör du?" />*@

				@*<br />
				<hr />
				<br />*@
				@*<p>
				Kontrollera att du sätter olika rangordning på vart och ett av de fyra olika orden i varje
				uppsättning. Gör inga garderingar. Fundera inte för länge på varje rad, arbeta spontant. Du
				kan tycka att det är svårt, men rangordna ändå.

				</p>*@
				@*<SurveyPrompt Title="Kontrollera att du sätter olika rangordning på vart och ett av de fyra olika orden i varje
			uppsättning. Gör inga garderingar. Fundera inte för länge på varje rad, arbeta spontant. Du
			kan tycka att det är svårt, men rangordna ändå." />*@
				@* <br /> *@

				@*<p> <b> <u> <b>SE INSTRUKTION</b></u></b></p>*@
				
				<br />
				

				<p> <b>Rangordna nedan 9 påståenden med siffrorna 1, 2, 3, 4, se exempel: </b></p>
				<p> <b> 1. prioritera ____2  |  pröva ____4  |  sammanfatta ____3  |  praktisera ____1 </b></p>
				<br />
				<br />
				<div class="button-right">
					<button class="btn-third" @onclick="ShowInstructionModal"> <i class="fas fa-question-circle"></i> &nbsp; SE INSTRUKTION </button>
				</div>
				
				@*<br />
				<br />*@
			</ul>
		</p>

		@*<br />*@

		<EditForm Model="InputModel" OnSubmit="HandleSubmitAsync">
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2> <b>1. </b> </label2>
				<br />
				<label>Prioritera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input11">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Pröva</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input12">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Sammanfatta</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input13">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Praktisera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input14">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2>
					<b>2. </b>
				</label2>
				<label>Mottaga</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input21">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Uppmärksamma</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input22">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Analysera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input23">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Opartisk</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input24">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2><b>3. </b></label2>
				<label>Känna</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input31">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Betrakta</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input32">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Tänka</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input33">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Göra</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input34">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2> <b>4. </b></label2>
				<label>Acceptera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input41">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Relatera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input42">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Värdera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input43">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Riskera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input44">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2><b>5. </b></label2>
				<label>Intuition</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input51">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Svara</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input52">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Logik</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input53">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Fråga</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input54">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2><b>6. </b></label2>
				<label>Konkretisera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input61">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Observera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input62">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Teoretisera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input63">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Aktivera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input64">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2><b>7. </b></label2>
				<label>Nuorientera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input71">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Reflektera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input72">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Framtidsorientera</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input73">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Tillämpa</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input74">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2><b>8. </b></label2>
				<label>Upplevelse</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input81">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Observation</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input82">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Begrepp</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input83">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Experiment</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input84">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>
			<div style="display:flex; margin-bottom:0.5rem;">
				<label2><b>9. </b></label2>
				<label>Känslor</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input91">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Avvakta</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input92">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Rationell</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input93">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
				<label>Engagerad</label>
				<InputSelect class="input-select" @bind-Value="InputModel.Input94">
					@for (int i = 1; i < 5; i++)
					{
						<option value="@i">@i</option>
					})
				</InputSelect>
			</div>

			@*<br />
			<br />*@






			@*<NavLink class="nav-link" href="ResultsPage">

			</NavLink>*@
			@*<br />
			<br />

			<br />*@
			<br />
			@*<hr />*@

		</EditForm>
		<br />

		
		<br />
		<br />

		<br />
		
		<br />
		<br />
	</div>
	

	<br />
</div>

<div class="button-row">

			<button class="btn-cancel" @onclick="ShowConfirmationModal"> AVBRYT TESTET </button>
			<button class="btn btn-primary" @onclick="HandleSubmitAsync">SLUTFÖR TESTET</button>

	@*type="submit"*@
			
			<br />
	
		</div>

@if (calculating)
{
	<div><div class="loading-spinner" style="display:flex;justify-content:center;"></div>Beräknar resultat, var god och vänta någon sekund...</div>
}

<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="confirmationModalLabel">Confirmation</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body modal-body-margin">
				Are you sure you want to cancel the test?
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">CANCEL</button>
				<button type="button" class="btn btn-primary" data-dismiss="modal" @onclick="HandleConfirm">CONFIRM</button>
			</div>
		</div>
	</div>
</div>

<div class="modal-width">

	<div class="modal fade " id="instructionModal" tabindex="-1" role="dialog" aria-labelledby="instructionModalLabel" aria-hidden="true">
	<div class="modal-dialog custom-modal-width" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="confirmationModalLabel"></h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<br>
					<h2>
						@*Kolbs lärstilar: testa din inlärningsstil*@
			Instruktion
		</h2>


					@*<h2> Instruktion </h2>*@
		<br />
					@*<b>Nedan ser du nio rader med fyra ord i varje rad</b>*@


		<div class="survey-left">
			<ul >
							@* <br /> *@
							@*<p>
			Jämför varje vågrät uppsättning med fyra ord genom att ge 4 till det ord som du tycker bäst
			beskriver din inlärningsstil, ge 3 till det ord som näst bäst karakteriserar din inlärningsstil, 2
			till det näst minst karakteristiska ordet och 1 till det ord som minst karakteriserar hur du lär
			dig.
			</p>*@

			<SurveyPrompt Title="Jämför varje vågrät uppsättning med fyra ord genom att ge 4 till det ord som du tycker bäst
			beskriver din inlärningsstil, ge 3 till det ord som näst bäst karakteriserar din inlärningsstil, 2
			till det näst minst karakteristiska ordet och 1 till det ord som minst karakteriserar hur du lär
			dig." />
							@*<br />
			<hr />
			<br />*@
							@*<p>
			<b>
			Uppskatta varje rad för sig och tänk på situationer då du arbetar eller studerar och tar in ny
			information eller arbetsuppgifter, hur gör du?
			</b>
			</p>*@

			<SurveyPrompt Title="Uppskatta varje rad för sig och tänk på situationer då du arbetar eller studerar och tar in ny
			information eller arbetsuppgifter, hur gör du?" />

							@*<br />
			<hr />
			<br />*@
							@*<p>
			Kontrollera att du sätter olika rangordning på vart och ett av de fyra olika orden i varje
			uppsättning. Gör inga garderingar. Fundera inte för länge på varje rad, arbeta spontant. Du
			kan tycka att det är svårt, men rangordna ändå.

			</p>*@
			<SurveyPrompt Title="Kontrollera att du sätter olika rangordning på vart och ett av de fyra olika orden i varje
			uppsättning. Gör inga garderingar. Fundera inte för länge på varje rad, arbeta spontant. Du
			kan tycka att det är svårt, men rangordna ändå." />
							@* <br /> *@



		</ul>
		</div>

					@*</p>*@
	<br />
	<h2><b>Exempel: </b></h2>

	<br />
	<p > <b>Rangordna nedan 9 påståenden med siffrorna 1, 2, 3, 4, se exempel: </b></p>
	<p> <b> 1. prioritera ____2  |  pröva ____4  |  sammanfatta ____3  |  praktisera ____1 </b></p>

	<br />
					@*<div class="exempel-img">*@
	<img class="exempel-img" src="NewFolder/exempel.png" alt="Test Example" />
					@*</div>*@
			</div>
			<div class="modal-footer">
					@*<button type="button" class="btn btn-secondary" data-dismiss="modal">CANCEL</button>*@
				<button type="button" class="btn btn-primary" data-dismiss="modal" >OK</button>
			</div>
		</div>
	</div>
</div>
</div>

@*<footer>
	<p>&copy; 2023 Kolb's "Learning Style" Test App. All rights reserved.</p>
</footer>*@

@if (_errorMessageIsVisible == true)
{
	<div class="error-message" @onclick="CloseErrorMessage">
		@*<div class="error-div">
	<h4 style="margin:0;">Du måste fylla i samtliga rutor, och du får bara fylla i en 1:a, en 2:a, en 3:a och en 4:a på varje rad.</h4>
	</div>*@

		@*<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">*@
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmationModalLabel">Error</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					Du måste fylla i samtliga rutor, och du får bara fylla i en 1:a, en 2:a, en 3:a och en 4:a på varje rad.
				</div>
				
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">CANCEL</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
		@*</div>*@

	</div>
}

<style>
	.error-div {
		width: auto;
		height: auto;
		background-color: white;
		padding: 1rem;
		border-radius: 0.5rem;
		box-shadow: 0 0 0.5rem 0.2rem rgba(0, 0, 0, 0.4);
	}

	.error-message {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.6);
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		z-index: 9999;
	}

	
	.modal-dialog
	{
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		
		text-align: center; /* This will center-align the text horizontally */
		
		
	}

	.modal-body-margin
	{
	text-align: left;
	}

	.survey-left
	{
		margin-left: -30px;
	}

	.button-right
	{
		display: flex;
		flex-direction: row;
		align-items: end;
		justify-content: end;
		margin-right: -82px;
		margin-bottom: -18px;
	}

	.custom-modal-width {
        max-width: 60%; 
        /*margin: 0 auto;*/ 
    }

	label {
		display: flex;
		width: 8rem;
		justify-content: flex-end;
		align-items: center;
		margin-right: 0.5rem;
		/*font-weight: bold;*/
	}

	label2 {
		display: flex;
		width: 2.5rem;
		justify-content: flex-end;
		align-items: center;
		margin-right: 0.5rem;
	}

	.input-select {
		border-radius: 3px;
	}

	.kolb-input {
		width: 4rem;
		margin-right: 1rem;
	}

	/* .font-example {
						font-family: 'MentiDisplay-Regular';
					} */

	.button-row {
		display: flex;
		justify-content: center;
		align-items: center;
		margin-top: 50px;
		margin-bottom: 50px;
	}

	.center-container {
		/*padding: 250px;*/
		padding: 150px;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		height: 1vh; /* This will center-align vertically by using the full viewport height */
		text-align: center; /* This will center-align the text horizontally */
	}

	.right-container {
		display: flex;
		/*flex-direction: column;*/
		padding-right: 10px;
		align-items: end;
		justify-content: right;
		/*height: 78vh; /* This will center-align vertically by using the full viewport height */
		text-align: center; /* This will center-align the text horizontally */
	}
	.exempel-img
	{
		width: 100%;
		/*height: 100%;*/
	}

	/*footer {
		background-color: #f8f8f8;
		padding-top: 20px;
		text-align: center;
	}*/

		footer p {
			color: #333;
		}
</style>

@code {
	public InputModel InputModel { get; set; } = new InputModel();
	private bool _errorMessageIsVisible = false;
	private bool calculating = false;

	private async Task ShowConfirmationModal()
	{
		await JSRuntime.InvokeVoidAsync("showModal");

		_errorMessageIsVisible = false;
	}

	private async Task ShowInstructionModal()
	{
		await JSRuntime.InvokeVoidAsync("showInstructionModal");

		_errorMessageIsVisible = false;
	}

	private void HandleConfirm()
	{
		NavigationManager.NavigateTo("/");
	}

	protected override void OnInitialized()
	{
		InputModel.Input11 = 0;
	}

	private void CloseErrorMessage()
	{
		_errorMessageIsVisible = false;
	}

	private async Task HandleSubmitAsync()
	{
		if (!ResultService.CheckInput(InputModel))
		{
			_errorMessageIsVisible = true;
		}
		else
		{
			calculating=true;
			// Skapa en resultmodel av inputModel
			ResultModel resultModel = ResultService.GetResultFromInput(InputModel);

			await JSRuntime.InvokeVoidAsync("sessionStorage.setItem", "result", JsonSerializer.Serialize(resultModel));

			if (await JSRuntime.InvokeAsync<string>("sessionStorage.getItem", "saveResultToDb") == "True")
			{
				await ResultService.AddResultAsync(resultModel);
				calculating = false;
				NavigationManager.NavigateTo("/TestResults");
			}
			calculating = false;
			NavigationManager.NavigateTo("/TestResults");
		}
	}
}
